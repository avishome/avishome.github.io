(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();class u{constructor(t,e){this.element=t,this.delegate=e,this.isDragging=!1,this.lastAngle=0,this.init()}init(){this.element.addEventListener("pointerdown",this.onPointerDown.bind(this)),window.addEventListener("pointermove",this.onPointerMove.bind(this)),window.addEventListener("pointerup",this.onPointerUp.bind(this)),this.element.addEventListener("wheel",this.onWheel.bind(this))}getAngle(t,e){const s=this.delegate.centerX,i=this.delegate.centerY;return Math.atan2(e-i,t-s)*(180/Math.PI)}onPointerDown(t){this.isDragging=!0,this.lastAngle=this.getAngle(t.clientX,t.clientY),this.element.setPointerCapture(t.pointerId)}onPointerMove(t){if(!this.isDragging)return;const e=this.getAngle(t.clientX,t.clientY);let s=e-this.lastAngle;s>180&&(s-=360),s<-180&&(s+=360),this.delegate.rotate(s),this.lastAngle=e}onPointerUp(t){this.isDragging=!1,this.element.releasePointerCapture(t.pointerId)}onWheel(t){if(t.preventDefault(),t.ctrlKey||t.metaKey){const e=t.deltaY>0?-.1:.1;this.delegate.setZoom(e)}else{const e=t.deltaY>0?-5:5;this.delegate.rotate(e)}}}class p{constructor(t,e,s){this.container=t,this.wheel=e,this.apiClient=s,this.currentTime=new Date,this.rotation=0,this.zoomLevel=1,this.HOURS=24,this.DEG_PER_HOUR=360/24,this.GAP_SIZE=60,this.centerX=0,this.centerY=0,this.radius=0,this.currentOrientation="portrait",this.inputHandler=new u(this.container,this),this.boundUpdateLayout=this.updateLayout.bind(this),this.renderLoop=this.render.bind(this),this.events=[],this.hand=null,this.card=document.getElementById("event-card"),this.setupCardUI()}async loadData(){if(!this.apiClient){console.warn("No API Client provided");return}const t=await this.apiClient.getEnrichedData();this.events=this.processEvents(t),this.generateEvents()}processEvents(t){const e={x:50,y:50};return t.map(s=>{const i=s.synagogue;let l=1-Math.sqrt(Math.pow(i.generatedCoords.x-e.x,2)+Math.pow(i.generatedCoords.y-e.y,2))/75*.5;l=Math.max(.5,Math.min(1,l));const[o,a]=s.time.split(":").map(Number),h=new Date;return h.setHours(o,a,0,0),{time:h,label:s.prayer_type,subLabel:i.name,type:s.prayer_type,color:i.color,distance:l,text:`${s.prayer_type} at ${i.name}
${i.area||""} - ${i.address||""}
${s.notes||""}`}})}setupCardUI(){this.card&&this.card.querySelector(".close-btn").addEventListener("click",()=>{this.card.classList.remove("active")})}showCard(t){if(!this.card)return;this.card.querySelector("#card-title").innerText=t.subLabel;const e=t.time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"});this.card.querySelector("#card-time").innerText=e,this.card.querySelector("#card-desc").innerText=t.text||"",this.card.classList.add("active")}init(){this.updateLayout(),this.buildStaticStructure(),this.generateTicks(),this.generateEvents(),this.updateRotationFromTime(),window.addEventListener("resize",this.boundUpdateLayout),requestAnimationFrame(this.renderLoop)}buildStaticStructure(){if(!this.wheel.querySelector(".clock-ring-outer")){const t=document.createElement("div");t.className="clock-ring-outer",this.wheel.appendChild(t);const e=document.createElement("div");e.className="clock-ring-inner",this.wheel.appendChild(e)}this.container.querySelector(".current-time-indicator")?this.hand=this.container.querySelector(".current-time-indicator"):(this.hand=document.createElement("div"),this.hand.className="current-time-indicator",this.container.appendChild(this.hand))}updateLayout(){const t=window.innerWidth,e=window.innerHeight,s=e>t;if(document.documentElement.dir,s)this.radius=Math.max(e*.85,300),this.centerY=e/2,this.centerX=t+this.radius*.4,this.currentOrientation="portrait-rtl";else{this.radius=Math.max(t*.5,300);const i=Math.min(e*.4,350);this.centerX=t/2,this.centerY=e-i+this.radius,this.currentOrientation="landscape"}this.wheel.style.width=`${this.radius*2}px`,this.wheel.style.height=`${this.radius*2}px`,this.wheel.style.left=`${this.centerX-this.radius}px`,this.wheel.style.top=`${this.centerY-this.radius}px`,this.hand&&(this.hand.style.left=`${this.centerX}px`,this.hand.style.top=`${this.centerY}px`,this.hand.style.height=`${this.radius+20}px`),this.updateRotationFromTime()}generateTicks(){this.wheel.querySelectorAll(".tick, .tick-label-container").forEach(e=>e.remove());for(let e=0;e<this.HOURS;e++){const s=e*this.DEG_PER_HOUR,i=document.createElement("div");i.className="tick",e%6===0&&i.classList.add("hour"),i.classList.add("hour");const n=this.radius-this.GAP_SIZE/2;i.style.height=`${this.GAP_SIZE*.6}px`,i.style.transform=`rotate(${s}deg) translate(0, -${n}px)`,this.wheel.appendChild(i);const r=document.createElement("div");r.className="tick-label",r.innerText=`${e}:00`;const l=this.radius-this.GAP_SIZE-25,o=document.createElement("div");o.className="tick-label-container",o.style.position="absolute",o.style.left="50%",o.style.top="50%",o.style.width="0",o.style.height="0",o.style.transform=`rotate(${s}deg) translate(0, -${l}px)`;const a=document.createElement("div");a.className="billboard-label",a.style.setProperty("--my-angle",`${s}deg`),a.appendChild(r),r.style.transform="translate(-50%, -50%)",o.appendChild(a),this.wheel.appendChild(o)}}generateEvents(){this.wheel.querySelectorAll(".clock-event").forEach(e=>e.remove()),this.events.forEach(e=>{const s=document.createElement("div");s.className="clock-event";const i=e.time.getHours(),n=e.time.getMinutes(),r=i*this.DEG_PER_HOUR+n*(this.DEG_PER_HOUR/60),o=(this.radius-this.GAP_SIZE-60)*e.distance;s.style.transform=`rotate(${r}deg) translate(0, -${o}px)`,s.style.setProperty("--my-angle",`${r}deg`);const a=e.color?`background-color: ${e.color}; box-shadow: 0 0 8px ${e.color};`:"";s.innerHTML=`
                <div class="billboard-content">
                    <div class="event-marker" style="${a}"></div>
                    <div class="event-label" style="color: ${e.color||"#fff"}">${e.label}</div>
                </div>
            `,s.addEventListener("pointerdown",h=>{h.stopPropagation(),this.showCard(e)}),this.wheel.appendChild(s)})}updateRotationFromTime(){const t=this.currentTime.getHours(),e=this.currentTime.getMinutes(),s=t*this.DEG_PER_HOUR+e*(this.DEG_PER_HOUR/60);let i=0;this.currentOrientation==="portrait-rtl"||this.currentOrientation==="landscape-rtl"?i=270:this.currentOrientation==="portrait-ltr"||this.currentOrientation==="landscape-ltr"?i=90:(this.currentOrientation==="landscape"||this.currentOrientation==="portrait")&&(i=0),this.rotation=i-s,this.hand&&(this.hand.style.transform=`translate(-50%, -100%) rotate(${i}deg)`,this.hand.style.transformOrigin="center bottom")}rotate(t){this.rotation+=t}setZoom(t){this.zoomLevel=Math.max(.5,Math.min(this.zoomLevel+t,3))}render(){this.wheel.style.transform=`scale(${this.zoomLevel}) rotate(${this.rotation}deg)`,this.wheel.style.setProperty("--wheel-rot",`${this.rotation}deg`),requestAnimationFrame(this.renderLoop)}}const m="bc26ba542d24491fa6d569e762b0c1b0",g="68f14c0949579c52b3f6685f",f=`https://app.base44.com/api/apps/${g}/entities`;function d(c){let t=0;for(let s=0;s<c.length;s++){const i=c.charCodeAt(s);t=(t<<5)-t+i,t=t&t}return Math.abs(t)/2147483647}class y{constructor(){this.cache=null}async fetchEntities(t){try{const e=await fetch(`${f}/${t}`,{headers:{api_key:m,"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch ${t}`);return await e.json()}catch(e){return console.error(e),[]}}async getEnrichedData(){const[t,e]=await Promise.all([this.fetchEntities("Synagogue"),this.fetchEntities("PrayerTime")]),s={};return t.forEach(n=>{const r=n.id,l=d(r+"x")*100,o=d(r+"y")*100,a=["#00f3ff","#d000ff","#ff0055","#ffe600","#00ff66"],h=Math.floor(d(r+"color")*a.length);s[n.id]={...n,generatedCoords:{x:l,y:o},color:a[h]}}),e.map(n=>{const r=s[n.synagogue_id];return r?{...n,synagogue:r}:null}).filter(Boolean)}}document.addEventListener("DOMContentLoaded",async()=>{const c=document.getElementById("clock-container"),t=document.getElementById("clock-wheel"),e=new y,s=new p(c,t,e);s.init(),await s.loadData()});
