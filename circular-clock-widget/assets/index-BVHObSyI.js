(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&i(n)}).observe(document,{childList:!0,subtree:!0});function t(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=t(s);fetch(s.href,r)}})();class g{constructor(e,t){this.element=e,this.delegate=t,this.isDragging=!1,this.lastAngle=0,this.init()}init(){this.element.addEventListener("pointerdown",this.onPointerDown.bind(this)),window.addEventListener("pointermove",this.onPointerMove.bind(this)),window.addEventListener("pointerup",this.onPointerUp.bind(this)),this.element.addEventListener("wheel",this.onWheel.bind(this))}getAngle(e,t){const i=this.delegate.centerX,s=this.delegate.centerY;return Math.atan2(t-s,e-i)*(180/Math.PI)}onPointerDown(e){this.isDragging=!0,this.lastAngle=this.getAngle(e.clientX,e.clientY),this.element.setPointerCapture(e.pointerId)}onPointerMove(e){if(!this.isDragging)return;const t=this.getAngle(e.clientX,e.clientY);let i=t-this.lastAngle;i>180&&(i-=360),i<-180&&(i+=360),this.delegate.rotate(i),this.lastAngle=t}onPointerUp(e){this.isDragging=!1,this.element.releasePointerCapture(e.pointerId)}onWheel(e){if(e.preventDefault(),e.ctrlKey||e.metaKey){const t=e.deltaY>0?-.1:.1;this.delegate.setZoom(t)}else{const t=e.deltaY>0?-5:5;this.delegate.rotate(t)}}}class f{constructor(e,t,i){this.container=e,this.wheel=t,this.apiClient=i,this.currentTime=new Date,this.rotation=0,this.zoomLevel=1,this.HOURS=24,this.DEG_PER_HOUR=360/24,this.GAP_SIZE=60,this.centerX=0,this.centerY=0,this.radius=0,this.currentOrientation="portrait",this.inputHandler=new g(this.container,this),this.boundUpdateLayout=this.updateLayout.bind(this),this.renderLoop=this.render.bind(this),this.events=[],this.hand=null,this.card=document.getElementById("event-card"),this.setupCardUI()}async loadData(){if(!this.apiClient){console.warn("No API Client provided");return}const e=await this.apiClient.getEnrichedData();this.events=this.processEvents(e),this.generateEvents()}processEvents(e){const t={x:50,y:50},i=e.map(n=>{const o=n.synagogue;let c=1-Math.sqrt(Math.pow(o.generatedCoords.x-t.x,2)+Math.pow(o.generatedCoords.y-t.y,2))/75*.5;c=Math.max(.75,Math.min(.98,c));const[d,u]=n.time.split(":").map(Number),m=new Date;return m.setHours(d,u,0,0),{time:m,timeStr:n.time,label:`${m.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} ${o.name}`,subLabel:o.name,type:n.prayer_type,color:o.color,distance:c,text:`${n.prayer_type} at ${o.name}
${o.area||""} - ${o.address||""}
${n.notes||""}`}}),s=this.distributeRadialOverlaps(i),r=new Set(s.map(n=>n.time.getTime()));return this.uniqueEventTimes=Array.from(r).sort((n,o)=>n-o),s}distributeRadialOverlaps(e){const t={};e.forEach(s=>{const r=s.time.getTime();t[r]||(t[r]=[]),t[r].push(s)});const i=[];return Object.values(t).forEach(s=>{if(s.length===1)i.push(s[0]);else{const r=.3999999999999999/(s.length+1);s.forEach((n,o)=>{n.distance=.55+r*(o+1),i.push(n)})}}),i}setupCardUI(){this.card&&(this.card.querySelector(".close-btn").addEventListener("click",()=>{this.card.classList.remove("active")}),document.addEventListener("pointerdown",e=>{this.card.classList.contains("active")&&!this.card.contains(e.target)&&!e.target.closest(".clock-event")&&this.card.classList.remove("active")}))}showCard(e){if(!this.card||!e.length)return;const t=e[0].time.getTime(),i=this.uniqueEventTimes.indexOf(t),s=e[0].time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),r=`
            <div class="card-header-row">
                <button class="nav-btn prev-btn" ${i<=0?"disabled":""}>&lt;</button>
                <span id="card-title">Prayers at ${s}</span>
                <button class="nav-btn next-btn" ${i>=this.uniqueEventTimes.length-1?"disabled":""}>&gt;</button>
            </div>
        `;this.card.querySelector("#card-title").parentElement;const n=this.card.querySelector("h3");n.innerHTML=r,this.card.querySelector("#card-time").innerText="";const o=e.map(c=>`
            <div class="card-list-item" style="border-left: 3px solid ${c.color}; margin-bottom: 8px; padding-left: 8px;">
                <div style="font-weight: bold; font-size: 1.1em;">${c.subLabel}</div>
                <div style="opacity: 0.8; font-size: 0.9em;">${c.type}</div>
                ${c.text.split(`
`).slice(1).join("<br>")}
            </div>
        `).join("");this.card.querySelector("#card-desc").innerHTML=`<div class="card-scroll-list">${o}</div>`,this.card.classList.add("active");const a=n.querySelector(".prev-btn"),l=n.querySelector(".next-btn");a&&(a.onclick=c=>{c.stopPropagation(),this.navigateCard(-1,i)}),l&&(l.onclick=c=>{c.stopPropagation(),this.navigateCard(1,i)})}navigateCard(e,t){const i=t+e;if(i>=0&&i<this.uniqueEventTimes.length){const s=this.uniqueEventTimes[i],r=this.events.filter(n=>n.time.getTime()===s);this.showCard(r)}}init(){this.updateLayout(),this.buildStaticStructure(),this.generateTicks(),this.generateEvents(),this.updateRotationFromTime(),window.addEventListener("resize",()=>{this.reInit()}),requestAnimationFrame(this.renderLoop)}reInit(){this.wheel.innerHTML="",this.hand&&(this.hand.remove(),this.hand=null),this.updateLayout(),this.buildStaticStructure(),this.generateTicks(),this.generateEvents(),this.updateRotationFromTime()}buildStaticStructure(){if(!this.wheel.querySelector(".clock-ring-outer")){const e=document.createElement("div");e.className="clock-ring-outer",this.wheel.appendChild(e);const t=document.createElement("div");t.className="clock-ring-inner",this.wheel.appendChild(t)}this.container.querySelector(".current-time-indicator")?this.hand=this.container.querySelector(".current-time-indicator"):(this.hand=document.createElement("div"),this.hand.className="current-time-indicator",this.container.appendChild(this.hand))}updateLayout(){const e=window.innerWidth,t=window.innerHeight,i=t>e;document.documentElement.dir,i?(this.radius=Math.max(t*.85,300),this.centerY=t/2,this.centerX=e+this.radius*.4,this.currentOrientation="portrait-rtl"):(this.radius=t*.9,this.centerX=e/2,this.centerY=this.radius+20,this.currentOrientation="landscape"),this.wheel.style.width=`${this.radius*2}px`,this.wheel.style.height=`${this.radius*2}px`,this.wheel.style.left=`${this.centerX-this.radius}px`,this.wheel.style.top=`${this.centerY-this.radius}px`,this.hand&&(this.hand.style.left=`${this.centerX}px`,this.hand.style.top=`${this.centerY}px`,this.hand.style.height=`${this.radius+20}px`),this.updateRotationFromTime()}generateTicks(){this.wheel.querySelectorAll(".tick, .tick-label-container").forEach(t=>t.remove());for(let t=0;t<this.HOURS;t++){const i=t*this.DEG_PER_HOUR,s=document.createElement("div");s.className="tick",t%6===0&&s.classList.add("hour"),s.classList.add("hour");const r=this.radius-this.GAP_SIZE/2;s.style.height=`${this.GAP_SIZE*.6}px`,s.style.transform=`rotate(${i}deg) translate(0, -${r}px)`,this.wheel.appendChild(s);const n=document.createElement("div");n.className="tick-label",n.innerText=`${t}:00`;const o=this.radius-this.GAP_SIZE-25,a=document.createElement("div");a.className="tick-label-container",a.style.position="absolute",a.style.left="50%",a.style.top="50%",a.style.width="0",a.style.height="0",a.style.transform=`rotate(${i}deg) translate(0, -${o}px)`;const l=document.createElement("div");l.className="billboard-label",l.style.setProperty("--my-angle",`${i}deg`),l.appendChild(n),n.style.transform="translate(-50%, -50%)",a.appendChild(l),this.wheel.appendChild(a)}}generateEvents(){this.wheel.querySelectorAll(".clock-event").forEach(t=>t.remove()),this.events.forEach(t=>{const i=document.createElement("div");i.className="clock-event";const s=t.time.getHours(),r=t.time.getMinutes(),n=s*this.DEG_PER_HOUR+r*(this.DEG_PER_HOUR/60),a=(this.radius-this.GAP_SIZE-60)*t.distance;i.style.transform=`rotate(${n}deg) translate(0, -${a}px)`,i.style.setProperty("--my-angle",`${n}deg`);const l=t.color?`background-color: ${t.color}; box-shadow: 0 0 8px ${t.color};`:"";i.innerHTML=`
                <div class="billboard-content">
                    <div class="event-marker" style="${l}"></div>
                    <div class="event-label" style="color: ${t.color||"#fff"}">${t.label}</div>
                </div>
            `,i.addEventListener("pointerdown",c=>{c.stopPropagation();const d=this.events.filter(u=>u.time.getTime()===t.time.getTime());this.showCard(d)}),this.wheel.appendChild(i)})}updateRotationFromTime(){const e=this.currentTime.getHours(),t=this.currentTime.getMinutes(),i=e*this.DEG_PER_HOUR+t*(this.DEG_PER_HOUR/60);let s=0;this.currentOrientation==="portrait-rtl"||this.currentOrientation==="landscape-rtl"?s=270:this.currentOrientation==="portrait-ltr"||this.currentOrientation==="landscape-ltr"?s=90:(this.currentOrientation==="landscape"||this.currentOrientation==="portrait")&&(s=0),this.rotation=s-i,this.hand&&(this.hand.style.transform=`translate(-50%, -100%) rotate(${s}deg)`,this.hand.style.transformOrigin="center bottom")}rotate(e){this.rotation+=e}setZoom(e){this.zoomLevel=Math.max(.5,Math.min(this.zoomLevel+e,3))}render(){this.wheel.style.transform=`scale(${this.zoomLevel}) rotate(${this.rotation}deg)`,this.wheel.style.setProperty("--wheel-rot",`${this.rotation}deg`),requestAnimationFrame(this.renderLoop)}}const y="bc26ba542d24491fa6d569e762b0c1b0",v="68f14c0949579c52b3f6685f",E=`https://app.base44.com/api/apps/${v}/entities`;function p(h){let e=0;for(let i=0;i<h.length;i++){const s=h.charCodeAt(i);e=(e<<5)-e+s,e=e&e}return Math.abs(e)/2147483647}class b{constructor(){this.cache=null}async fetchEntities(e){try{const t=await fetch(`${E}/${e}`,{headers:{api_key:y,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to fetch ${e}`);return await t.json()}catch(t){return console.error(t),[]}}async getEnrichedData(){const[e,t]=await Promise.all([this.fetchEntities("Synagogue"),this.fetchEntities("PrayerTime")]),i={};return e.forEach(r=>{const n=r.id,o=p(n+"x")*100,a=p(n+"y")*100,l=this.stringToHash(r.name||r.id),c=["#00f3ff","#d000ff","#ff0055","#ffe600","#00ff66","#ff9900","#0066ff","#ccff00","#ff3399","#00ffcc","#9900ff"],d=Math.abs(l)%c.length;i[r.id]={...r,generatedCoords:{x:o,y:a},color:c[d]}}),t.map(r=>{const n=i[r.synagogue_id];return n?{...r,synagogue:n}:null}).filter(Boolean)}stringToHash(e){let t=0;for(let i=0;i<e.length;i++){const s=e.charCodeAt(i);t=(t<<5)-t+s,t=t&t}return t}}document.addEventListener("DOMContentLoaded",async()=>{const h=document.getElementById("clock-container"),e=document.getElementById("clock-wheel"),t=new b,i=new f(h,e,t);i.init(),await i.loadData()});
