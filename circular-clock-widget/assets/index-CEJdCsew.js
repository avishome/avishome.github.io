(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))e(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&e(n)}).observe(document,{childList:!0,subtree:!0});function i(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function e(s){if(s.ep)return;s.ep=!0;const r=i(s);fetch(s.href,r)}})();class S{constructor(t,i){this.element=t,this.delegate=i,this.isDragging=!1,this.lastAngle=0,this.init()}init(){this.element.addEventListener("pointerdown",this.onPointerDown.bind(this)),window.addEventListener("pointermove",this.onPointerMove.bind(this)),window.addEventListener("pointerup",this.onPointerUp.bind(this)),this.element.addEventListener("wheel",this.onWheel.bind(this))}getAngle(t,i){const e=this.delegate.centerX,s=this.delegate.centerY;return Math.atan2(i-s,t-e)*(180/Math.PI)}onPointerDown(t){this.isDragging=!0,this.lastAngle=this.getAngle(t.clientX,t.clientY),this.element.setPointerCapture(t.pointerId)}onPointerMove(t){if(!this.isDragging)return;const i=this.getAngle(t.clientX,t.clientY);let e=i-this.lastAngle;e>180&&(e-=360),e<-180&&(e+=360),this.delegate.rotate(e),this.lastAngle=i}onPointerUp(t){this.isDragging=!1,this.element.releasePointerCapture(t.pointerId)}onWheel(t){if(t.preventDefault(),t.ctrlKey||t.metaKey){const i=t.deltaY>0?-.1:.1;this.delegate.setZoom(i)}else{const i=t.deltaY>0?-5:5;this.delegate.rotate(i)}}}class T{constructor(t,i,e){this.container=t,this.wheel=i,this.apiClient=e,this.currentTime=new Date,this.rotation=0,this.zoomLevel=1,this.HOURS=24,this.DEG_PER_HOUR=360/24,this.GAP_SIZE=60,this.centerX=0,this.centerY=0,this.radius=0,this.currentOrientation="portrait",this.inputHandler=new S(this.container,this),this.boundUpdateLayout=this.updateLayout.bind(this),this.renderLoop=this.render.bind(this),this.events=[],this.hand=null,this.card=document.getElementById("event-card"),this.setupCardUI()}async loadData(){if(!this.apiClient){console.warn("No API Client provided");return}const t=await this.apiClient.getEnrichedData();this.events=this.processEvents(t),this.generateEvents()}processEvents(t){const i={x:50,y:50},e=t.map(n=>{const a=n.synagogue;let c=1-Math.sqrt(Math.pow(a.generatedCoords.x-i.x,2)+Math.pow(a.generatedCoords.y-i.y,2))/75*.5;c=Math.max(.6,Math.min(.95,c));const[h,y]=n.time.split(":").map(Number),u=new Date;return u.setHours(h,y,0,0),{time:u,timeStr:n.time,label:`${u.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} ${a.name}`,subLabel:a.name,type:n.prayer_type,color:a.color,distance:c,text:`${n.prayer_type} at ${a.name}
${a.area||""} - ${a.address||""}
${n.notes||""}`}}),s=this.resolveSpatialCollisions(e),r=new Set(s.map(n=>n.time.getTime()));return this.uniqueEventTimes=Array.from(r).sort((n,a)=>n-a),s}resolveSpatialCollisions(t){const i={};t.forEach(r=>{const n=r.time.getTime();i[n]||(i[n]=[]),i[n].push(r)});const e=[],s=.08;return Object.values(i).forEach(r=>{if(r.length===1){let n=r[0];n.distance=Math.max(.6,Math.min(.95,n.distance)),e.push(n)}else{r.sort((a,o)=>o.distance-a.distance);let n=.95;r.forEach(a=>{a.distance=n,e.push(a),n-=s})}}),e.forEach(r=>{r.distance=Math.max(.4,Math.min(.98,r.distance))}),e}setupCardUI(){this.card&&(this.card.querySelector(".close-btn").addEventListener("click",()=>{this.card.classList.remove("active")}),document.addEventListener("pointerdown",t=>{this.card.classList.contains("active")&&!this.card.contains(t.target)&&!t.target.closest(".clock-event")&&this.card.classList.remove("active")}))}showCard(t){if(!this.card||!t.length)return;const i=t[0].time.getTime(),e=this.uniqueEventTimes.indexOf(i),s=t[0].time.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"}),r=`
            <div class="card-header-row">
                <button class="nav-btn prev-btn" ${e<=0?"disabled":""}>&lt;</button>
                <span id="card-title">Prayers at ${s}</span>
                <button class="nav-btn next-btn" ${e>=this.uniqueEventTimes.length-1?"disabled":""}>&gt;</button>
            </div>
        `;this.card.querySelector("#card-title").parentElement;const n=this.card.querySelector("h3");n.innerHTML=r,this.card.querySelector("#card-time").innerText="";const a=t.map(c=>`
            <div class="card-list-item" style="border-left: 3px solid ${c.color}; margin-bottom: 8px; padding-left: 8px;">
                <div style="font-weight: bold; font-size: 1.1em;">${c.subLabel}</div>
                <div style="opacity: 0.8; font-size: 0.9em;">${c.type}</div>
                ${c.text.split(`
`).slice(1).join("<br>")}
            </div>
        `).join("");this.card.querySelector("#card-desc").innerHTML=`<div class="card-scroll-list">${a}</div>`,this.card.classList.add("active");const o=n.querySelector(".prev-btn"),l=n.querySelector(".next-btn");o&&(o.onclick=c=>{c.stopPropagation(),this.navigateCard(-1,e)}),l&&(l.onclick=c=>{c.stopPropagation(),this.navigateCard(1,e)})}navigateCard(t,i){const e=i+t;if(e>=0&&e<this.uniqueEventTimes.length){const s=this.uniqueEventTimes[e],r=this.events.filter(n=>n.time.getTime()===s);this.showCard(r)}}init(){this.updateLayout(),this.buildStaticStructure(),this.generateTicks(),this.generateEvents(),this.updateRotationFromTime(),window.addEventListener("resize",()=>{this.reInit()}),requestAnimationFrame(this.renderLoop)}reInit(){this.wheel.innerHTML="",this.hand&&(this.hand.remove(),this.hand=null),this.updateLayout(),this.buildStaticStructure(),this.generateTicks(),this.generateEvents(),this.updateRotationFromTime()}buildStaticStructure(){if(!this.wheel.querySelector(".clock-ring-outer")){const t=document.createElement("div");t.className="clock-ring-outer",this.wheel.appendChild(t);const i=document.createElement("div");i.className="clock-ring-inner",this.wheel.appendChild(i)}this.container.querySelector(".current-time-indicator")?this.hand=this.container.querySelector(".current-time-indicator"):(this.hand=document.createElement("div"),this.hand.className="current-time-indicator",this.container.appendChild(this.hand))}updateLayout(){const t=window.innerWidth,i=window.innerHeight,e=i>t;document.documentElement.dir,e?(this.radius=Math.max(i*.85,300),this.centerY=i/2,this.centerX=t+this.radius*.4,this.currentOrientation="portrait-rtl"):(this.radius=i*.9,this.centerX=t/2,this.centerY=this.radius+20,this.currentOrientation="landscape"),this.wheel.style.width=`${this.radius*2}px`,this.wheel.style.height=`${this.radius*2}px`,this.wheel.style.left=`${this.centerX-this.radius}px`,this.wheel.style.top=`${this.centerY-this.radius}px`,this.hand&&(this.hand.style.left=`${this.centerX}px`,this.hand.style.top=`${this.centerY}px`,this.hand.style.height=`${this.radius+20}px`),this.updateRotationFromTime()}generateTicks(){this.wheel.querySelectorAll(".tick, .tick-label-container").forEach(i=>i.remove());for(let i=0;i<this.HOURS;i++){const e=i*this.DEG_PER_HOUR,s=document.createElement("div");s.className="tick",i%6===0&&s.classList.add("hour"),s.classList.add("hour");const r=this.radius-this.GAP_SIZE/2;s.style.height=`${this.GAP_SIZE*.6}px`,s.style.transform=`rotate(${e}deg) translate(0, -${r}px)`,this.wheel.appendChild(s);const n=document.createElement("div");n.className="tick-label",n.innerText=`${i}:00`;const a=this.radius-this.GAP_SIZE-25,o=document.createElement("div");o.className="tick-label-container",o.style.position="absolute",o.style.left="50%",o.style.top="50%",o.style.width="0",o.style.height="0",o.style.transform=`rotate(${e}deg) translate(0, -${a}px)`;const l=document.createElement("div");l.className="billboard-label",l.style.setProperty("--my-angle",`${e}deg`),l.appendChild(n),n.style.transform="translate(-50%, -50%)",o.appendChild(l),this.wheel.appendChild(o)}}generateEvents(){this.wheel.querySelectorAll(".clock-event").forEach(e=>e.remove()),this.events.sort((e,s)=>e.distance-s.distance).forEach(e=>{const s=document.createElement("div");s.className="clock-event-container";const r=e.time.getHours(),n=e.time.getMinutes(),a=r*this.DEG_PER_HOUR+n*(this.DEG_PER_HOUR/60),o=document.createElement("div");o.className="guide-line",o.style.height=`${this.radius}px`,o.style.transform=`rotate(${a}deg)`,this.radius*(1-e.distance);const l=this.radius*(1-e.distance),c=document.createElement("div");c.className="guide-line-dash",c.style.height=`${l}px`;const h=document.createElement("div");h.className="guide-line-segment",(this.radius-this.GAP_SIZE-60)*e.distance;const u=(this.radius-this.GAP_SIZE-60)*e.distance,E=this.radius-u;h.style.height=`${E}px`,h.style.transform=`rotate(${a}deg) translate(0, -${this.radius}px)`;const m=document.createElement("div");m.className="clock-event",m.style.transform=`rotate(${a}deg) translate(0, -${u}px)`,m.style.setProperty("--my-angle",`${a}deg`);const b=e.color?`background-color: ${e.color}; box-shadow: 0 0 8px ${e.color};`:"",w=this.radius+20,x=document.createElement("div");x.className="time-label-external";const g=document.createElement("div");g.className="time-label-container",g.style.transform=`rotate(${a}deg) translate(0, -${w}px)`;const f=document.createElement("div");f.className="billboard-time",f.innerText=e.timeStr,f.style.setProperty("--my-angle",`${a}deg`),g.appendChild(f);const p=document.createElement("div");p.className="guide-dash",p.style.height=`${this.radius-u}px`,p.style.bottom="50%",p.style.left="50%",p.style.transform="translate(-50%, 0)",m.innerHTML=`
                ${p.outerHTML}
                <div class="billboard-content">
                    <div class="synagogue-label" style="color: ${e.color||"#fff"}">${e.subLabel}</div>
                    <div class="event-marker" style="${b}"></div>
                </div>
            `,m.addEventListener("pointerdown",$=>{$.stopPropagation();const L=this.events.filter(P=>P.time.getTime()===e.time.getTime());this.showCard(L)}),this.wheel.appendChild(g),this.wheel.appendChild(m)})}updateRotationFromTime(){const t=this.currentTime.getHours(),i=this.currentTime.getMinutes(),e=t*this.DEG_PER_HOUR+i*(this.DEG_PER_HOUR/60);let s=0;this.currentOrientation==="portrait-rtl"||this.currentOrientation==="landscape-rtl"?s=270:this.currentOrientation==="portrait-ltr"||this.currentOrientation==="landscape-ltr"?s=90:(this.currentOrientation==="landscape"||this.currentOrientation==="portrait")&&(s=0),this.rotation=s-e,this.hand&&(this.hand.style.transform=`translate(-50%, -100%) rotate(${s}deg)`,this.hand.style.transformOrigin="center bottom")}rotate(t){this.rotation+=t}setZoom(t){this.zoomLevel=Math.max(.5,Math.min(this.zoomLevel+t,3))}render(){this.wheel.style.transform=`scale(${this.zoomLevel}) rotate(${this.rotation}deg)`,this.wheel.style.setProperty("--wheel-rot",`${this.rotation}deg`),requestAnimationFrame(this.renderLoop)}}const C="bc26ba542d24491fa6d569e762b0c1b0",A="68f14c0949579c52b3f6685f",D=`https://app.base44.com/api/apps/${A}/entities`;function v(d){let t=0;for(let e=0;e<d.length;e++){const s=d.charCodeAt(e);t=(t<<5)-t+s,t=t&t}return Math.abs(t)/2147483647}class M{constructor(){this.cache=null}async fetchEntities(t){try{const i=await fetch(`${D}/${t}`,{headers:{api_key:C,"Content-Type":"application/json"}});if(!i.ok)throw new Error(`Failed to fetch ${t}`);return await i.json()}catch(i){return console.error(i),[]}}async getEnrichedData(){const[t,i]=await Promise.all([this.fetchEntities("Synagogue"),this.fetchEntities("PrayerTime")]),e={};return t.forEach(r=>{const n=r.id,a=v(n+"x")*100,o=v(n+"y")*100,l=this.stringToHash(r.name||r.id),c=["#00f3ff","#d000ff","#ff0055","#ffe600","#00ff66","#ff9900","#0066ff","#ccff00","#ff3399","#00ffcc","#9900ff"],h=Math.abs(l)%c.length;e[r.id]={...r,generatedCoords:{x:a,y:o},color:c[h]}}),i.map(r=>{const n=e[r.synagogue_id];return n?{...r,synagogue:n}:null}).filter(Boolean)}stringToHash(t){let i=0;for(let e=0;e<t.length;e++){const s=t.charCodeAt(e);i=(i<<5)-i+s,i=i&i}return i}}document.addEventListener("DOMContentLoaded",async()=>{const d=document.getElementById("clock-container"),t=document.getElementById("clock-wheel"),i=new M,e=new T(d,t,i);e.init(),await e.loadData()});
