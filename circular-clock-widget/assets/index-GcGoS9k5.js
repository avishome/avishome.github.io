(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const r of n.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=e(s);fetch(s.href,n)}})();class y{constructor(t,e){this.element=t,this.delegate=e,this.isDragging=!1,this.lastAngle=0,this.init()}init(){this.element.addEventListener("pointerdown",this.onPointerDown.bind(this)),window.addEventListener("pointermove",this.onPointerMove.bind(this)),window.addEventListener("pointerup",this.onPointerUp.bind(this)),this.element.addEventListener("wheel",this.onWheel.bind(this))}getAngle(t,e){const i=this.delegate.centerX,s=this.delegate.centerY;return Math.atan2(e-s,t-i)*(180/Math.PI)}onPointerDown(t){this.isDragging=!0,this.lastAngle=this.getAngle(t.clientX,t.clientY),this.element.setPointerCapture(t.pointerId)}onPointerMove(t){if(!this.isDragging)return;const e=this.getAngle(t.clientX,t.clientY);let i=e-this.lastAngle;i>180&&(i-=360),i<-180&&(i+=360),this.delegate.rotate(i),this.lastAngle=e}onPointerUp(t){this.isDragging=!1,this.element.releasePointerCapture(t.pointerId)}onWheel(t){if(t.preventDefault(),t.ctrlKey||t.metaKey){const e=t.deltaY>0?-.1:.1;this.delegate.setZoom(e)}else{const e=t.deltaY>0?-5:5;this.delegate.rotate(e)}}}class E{constructor(t,e,i){this.container=t,this.wheel=e,this.apiClient=i,this.currentTime=new Date,this.rotation=0,this.zoomLevel=1,this.HOURS=24,this.DEG_PER_HOUR=360/24,this.GAP_SIZE=60,this.centerX=0,this.centerY=0,this.radius=0,this.currentOrientation="portrait",this.inputHandler=new y(this.container,this),this.boundUpdateLayout=this.updateLayout.bind(this),this.renderLoop=this.render.bind(this),this.events=[],this.hand=null,this.linearOverlay=document.getElementById("linear-overlay"),this.linearList=document.getElementById("linear-list"),this.setupOverlayUI()}setupOverlayUI(){if(!this.linearOverlay)return;const t=this.linearOverlay.querySelector(".overlay-close-btn");t&&t.addEventListener("click",()=>{this.linearOverlay.classList.add("hidden")}),this.linearOverlay.addEventListener("click",e=>{e.target===this.linearOverlay&&this.linearOverlay.classList.add("hidden")})}async loadData(){if(!this.apiClient){console.warn("No API Client provided");return}const t=await this.apiClient.getEnrichedData();this.events=this.processEvents(t),this.generateEvents()}processEvents(t){const e={x:50,y:50},i=t.map(r=>{const a=r.synagogue;let l=1-Math.sqrt(Math.pow(a.generatedCoords.x-e.x,2)+Math.pow(a.generatedCoords.y-e.y,2))/75*.5;l=Math.max(.6,Math.min(.95,l));const[c,u]=r.time.split(":").map(Number),p=new Date;return p.setHours(c,u,0,0),{time:p,timeStr:r.time,label:`${p.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})} ${a.name}`,subLabel:a.name,type:r.prayer_type,color:a.color,distance:l,text:`${r.prayer_type} at ${a.name}
${a.area||""} - ${a.address||""}
${r.notes||""}`}}),s=this.resolveSpatialCollisions(i),n=new Set(s.map(r=>r.time.getTime()));return this.uniqueEventTimes=Array.from(n).sort((r,a)=>r-a),s}resolveSpatialCollisions(t){const e={};t.forEach(n=>{const r=n.time.getTime();e[r]||(e[r]=[]),e[r].push(n)});const i=[],s=.08;return Object.values(e).forEach(n=>{if(n.length===1){let r=n[0];r.distance=Math.max(.6,Math.min(.95,r.distance)),i.push(r)}else{n.sort((a,o)=>o.distance-a.distance);let r=.95;n.forEach(a=>{a.distance=r,i.push(a),r-=s})}}),i.forEach(n=>{n.distance=Math.max(.4,Math.min(.98,n.distance))}),i}showLinearView(t){if(!this.linearOverlay||!this.linearList)return;const e=[...this.events].sort((s,n)=>s.time.getTime()-n.time.getTime());this.linearList.innerHTML="";let i=null;e.forEach(s=>{const n=document.createElement("div");n.className="schedule-item",s===t&&n.classList.add("active"),n.innerHTML=`
                <div class="item-time">${s.timeStr}</div>
                <div class="item-dash-connector"></div>
                <div class="item-details">
                    <div class="item-name" style="color: ${s.color||"#fff"}">${s.subLabel}</div>
                    <div class="item-type">${s.type}</div>
                </div>
            `,this.linearList.appendChild(n),s===t&&(i=n)}),this.linearOverlay.classList.remove("hidden"),setTimeout(()=>{i&&i.scrollIntoView({behavior:"smooth",block:"center"})},50)}init(){this.updateLayout(),this.buildStaticStructure(),this.generateTicks(),this.generateEvents(),this.updateRotationFromTime(),window.addEventListener("resize",()=>{this.reInit()}),requestAnimationFrame(this.renderLoop)}reInit(){this.wheel.innerHTML="",this.hand&&(this.hand.remove(),this.hand=null),this.updateLayout(),this.buildStaticStructure(),this.generateTicks(),this.generateEvents(),this.updateRotationFromTime()}buildStaticStructure(){if(!this.wheel.querySelector(".clock-ring-outer")){const t=document.createElement("div");t.className="clock-ring-outer",this.wheel.appendChild(t);const e=document.createElement("div");e.className="clock-ring-inner",this.wheel.appendChild(e)}this.container.querySelector(".current-time-indicator")?this.hand=this.container.querySelector(".current-time-indicator"):(this.hand=document.createElement("div"),this.hand.className="current-time-indicator",this.container.appendChild(this.hand))}updateLayout(){const t=window.innerWidth,e=window.innerHeight,i=e>t;document.documentElement.dir,i?(this.radius=Math.max(e*.85,300),this.centerY=e/2,this.centerX=t+this.radius*.4,this.currentOrientation="portrait-rtl"):(this.radius=e*.9,this.centerX=t/2,this.centerY=this.radius+20,this.currentOrientation="landscape"),this.wheel.style.width=`${this.radius*2}px`,this.wheel.style.height=`${this.radius*2}px`,this.wheel.style.left=`${this.centerX-this.radius}px`,this.wheel.style.top=`${this.centerY-this.radius}px`,this.hand&&(this.hand.style.left=`${this.centerX}px`,this.hand.style.top=`${this.centerY}px`,this.hand.style.height=`${this.radius+20}px`),this.updateRotationFromTime()}generateTicks(){this.wheel.querySelectorAll(".tick, .tick-label-container").forEach(e=>e.remove());for(let e=0;e<this.HOURS;e++){const i=e*this.DEG_PER_HOUR,s=document.createElement("div");s.className="tick",e%6===0&&s.classList.add("hour"),s.classList.add("hour");const n=this.radius-this.GAP_SIZE/2;s.style.height=`${this.GAP_SIZE*.6}px`,s.style.transform=`rotate(${i}deg) translate(0, -${n}px)`,this.wheel.appendChild(s);const r=document.createElement("div");r.className="tick-label",r.innerText=`${e}:00`;const a=this.radius-this.GAP_SIZE-25,o=document.createElement("div");o.className="tick-label-container",o.style.position="absolute",o.style.left="50%",o.style.top="50%",o.style.width="0",o.style.height="0",o.style.transform=`rotate(${i}deg) translate(0, -${a}px)`;const h=document.createElement("div");h.className="billboard-label",h.style.setProperty("--my-angle",`${i}deg`),h.appendChild(r),r.style.transform="translate(-50%, -50%)",o.appendChild(h),this.wheel.appendChild(o)}}generateEvents(){this.wheel.querySelectorAll(".clock-event, .time-label-container").forEach(i=>i.remove()),this.events.sort((i,s)=>i.distance-s.distance).forEach(i=>{const s=i.time.getHours(),n=i.time.getMinutes(),r=s*this.DEG_PER_HOUR+n*(this.DEG_PER_HOUR/60),o=(this.radius-this.GAP_SIZE-60)*i.distance,h=this.radius+20,l=document.createElement("div");l.className="time-label-container",l.style.transform=`rotate(${r}deg) translate(0, -${h}px)`;const c=document.createElement("div");c.className="billboard-time",c.innerText=i.timeStr,c.style.setProperty("--my-angle",`${r}deg`),c.style.cursor="pointer",c.style.pointerEvents="auto",c.addEventListener("pointerdown",f=>{f.stopPropagation(),this.showLinearView(i)}),l.appendChild(c);const u=document.createElement("div");u.className="clock-event",u.style.transform=`rotate(${r}deg) translate(0, -${o}px)`,u.style.setProperty("--my-angle",`${r}deg`);const p=i.color?`background-color: ${i.color}; box-shadow: 0 0 8px ${i.color};`:"",m=document.createElement("div");m.className="guide-dash",m.style.height=`${this.radius-o}px`,m.style.bottom="50%",m.style.left="50%",m.style.transform="translate(-50%, 0)",u.innerHTML=`
                ${m.outerHTML}
                <div class="billboard-content">
                    <div class="synagogue-label" style="color: ${i.color||"#fff"}">${i.subLabel}</div>
                    <div class="event-marker" style="${p}"></div>
                </div>
            `,u.addEventListener("pointerdown",f=>{f.stopPropagation(),this.showLinearView(i)}),this.wheel.appendChild(l),this.wheel.appendChild(u)})}updateRotationFromTime(){const t=this.currentTime.getHours(),e=this.currentTime.getMinutes(),i=t*this.DEG_PER_HOUR+e*(this.DEG_PER_HOUR/60);let s=0;this.currentOrientation==="portrait-rtl"||this.currentOrientation==="landscape-rtl"?s=270:this.currentOrientation==="portrait-ltr"||this.currentOrientation==="landscape-ltr"?s=90:(this.currentOrientation==="landscape"||this.currentOrientation==="portrait")&&(s=0),this.rotation=s-i,this.hand&&(this.hand.style.transform=`translate(-50%, -100%) rotate(${s}deg)`,this.hand.style.transformOrigin="center bottom")}rotate(t){this.rotation+=t}setZoom(t){this.zoomLevel=Math.max(.5,Math.min(this.zoomLevel+t,3))}render(){this.wheel.style.transform=`scale(${this.zoomLevel}) rotate(${this.rotation}deg)`,this.wheel.style.setProperty("--wheel-rot",`${this.rotation}deg`),requestAnimationFrame(this.renderLoop)}}const v="bc26ba542d24491fa6d569e762b0c1b0",w="68f14c0949579c52b3f6685f",b=`https://app.base44.com/api/apps/${w}/entities`;function g(d){let t=0;for(let i=0;i<d.length;i++){const s=d.charCodeAt(i);t=(t<<5)-t+s,t=t&t}return Math.abs(t)/2147483647}class L{constructor(){this.cache=null}async fetchEntities(t){try{const e=await fetch(`${b}/${t}`,{headers:{api_key:v,"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to fetch ${t}`);return await e.json()}catch(e){return console.error(e),[]}}async getEnrichedData(){const[t,e]=await Promise.all([this.fetchEntities("Synagogue"),this.fetchEntities("PrayerTime")]),i={};return t.forEach(n=>{const r=n.id,a=g(r+"x")*100,o=g(r+"y")*100,h=this.stringToHash(n.name||n.id),l=["#00f3ff","#d000ff","#ff0055","#ffe600","#00ff66","#ff9900","#0066ff","#ccff00","#ff3399","#00ffcc","#9900ff"],c=Math.abs(h)%l.length;i[n.id]={...n,generatedCoords:{x:a,y:o},color:l[c]}}),e.map(n=>{const r=i[n.synagogue_id];return r?{...n,synagogue:r}:null}).filter(Boolean)}stringToHash(t){let e=0;for(let i=0;i<t.length;i++){const s=t.charCodeAt(i);e=(e<<5)-e+s,e=e&e}return e}}document.addEventListener("DOMContentLoaded",async()=>{const d=document.getElementById("clock-container"),t=document.getElementById("clock-wheel"),e=new L,i=new E(d,t,e);i.init(),await i.loadData()});
